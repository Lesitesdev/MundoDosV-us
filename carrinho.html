<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Carrinho - Mundo dos V√©us</title>
  <script src="js/carrinho.js" defer></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">

  <!-- Cabe√ßalho -->
  <header class="bg-white shadow-md px-6 py-4">
    <div class="max-w-6xl mx-auto flex items-center">
      <!-- Logo -->
      <a href="index.html" class="text-2xl font-bold text-purple-700">Mundo dos V√©us</a>

      <!-- Navega√ß√£o -->
      <nav class="ml-8 hidden md:flex space-x-6">
        <a href="index.html"    class="text-gray-700 hover:text-purple-700">In√≠cio</a>
        <a href="produtos.html" class="text-gray-700 hover:text-purple-700">Produtos</a>
        <a href="sobre.html"    class="text-gray-700 hover:text-purple-700">Sobre</a>
        <a href="contato.html"  class="text-gray-700 hover:text-purple-700">Contato</a>
        <a href="cliente.html" id="account-link" class="text-gray-700 hover:text-purple-700 hidden">Meu Cadastro</a>
      </nav>

      <div class="flex-1"></div>

      <!-- Carrinho -->
      <a href="carrinho.html" class="text-2xl text-gray-700 hover:text-purple-700 mr-6">üõí</a>

      <!-- Sauda√ß√£o + Logout (s√≥ logado) -->
      <div id="user-info" class="flex items-center space-x-2 hidden">
        <span id="saudacao" class="text-gray-700"></span>
        <button id="logout-link" class="text-gray-700 hover:text-purple-700">üö™ Logout</button>
      </div>

      <!-- Login (s√≥ n√£o-logado) -->
      <a href="login.html" id="login-link" class="text-gray-700 hover:text-purple-700">üë§ Login</a>
    </div>
  </header>

  <main class="max-w-3xl mx-auto mt-6 p-4 bg-white shadow-md rounded">
    <h2 class="text-xl font-bold mb-4">Seu Carrinho</h2>

    <!-- Bot√£o para Voltar √† P√°gina Anterior -->
    <div class="mt-4 mb-6">
      <a href="/produtos.html" class="flex items-center text-purple-600 hover:text-purple-800">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 12H5" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l-7-7 7-7" />
        </svg>
        Voltar
      </a>
    </div>

    <!-- Lista de Itens no Carrinho -->
    <ul id="itens-carrinho" class="space-y-3"></ul>

    <!-- Subtotal -->
    <div class="mt-6 flex justify-between items-center border-t pt-4">
      <span class="text-lg font-semibold">Subtotal dos Produtos:</span>
      <span id="subtotal-carrinho" class="text-2xl font-bold text-purple-700">0.00</span>
    </div>

    <!-- Frete -->
    <div class="mt-6">
      <label for="cep" class="block text-sm font-semibold">Digite seu CEP para cotar o frete:</label>
      <div class="flex items-center gap-4">
        <input type="text" id="cep" name="cep" class="w-full p-2 border rounded" placeholder="CEP" required>
        <button type="button" id="calcular-frete" class="bg-purple-700 text-white px-6 py-2 rounded hover:bg-purple-800 transition">
          Calcular Frete
        </button>
      </div>
      <div id="resultado-frete" class="mt-4 text-lg font-semibold text-purple-700"></div>
    </div>

    <!-- Cupom -->
    <div class="mt-6">
      <label for="cupom" class="block text-sm font-semibold">Insira seu cupom de desconto:</label>
      <div class="flex items-center gap-4">
        <input type="text" id="cupom" name="cupom" class="w-full p-2 border rounded" placeholder="Cupom de desconto">
        <button type="button" id="aplicar-cupom" class="bg-purple-700 text-white px-6 py-2 rounded hover:bg-purple-800 transition">
          Aplicar
        </button>
      </div>
      <div id="resultado-cupom" class="mt-4 text-lg font-semibold text-green-700"></div>
    </div>

    <!-- Total Final -->
    <div class="mt-6 flex justify-between items-center border-t pt-4">
      <span class="text-lg font-semibold">Total Final:</span>
      <span id="total-final" class="text-2xl font-bold text-purple-700">0.00</span>
    </div>

    <!-- Bot√µes -->
    <div class="mt-6 text-right">
      <a href="/dadosclientes.html" target="_blank"
         class="bg-purple-700 text-white px-6 py-2 rounded hover:bg-purple-800 transition">
        Finalizar Compra
      </a>
    </div>
    <div class="mt-4">
      <a href="produtos.html" class="inline-block bg-purple-700 text-white py-2 px-6 rounded-full hover:bg-purple-800 transition">
        Voltar aos Produtos
      </a>
    </div>
  </main>

  <!-- Rodap√© -->
  <footer class="bg-purple-800 text-white py-10 mt-10">
    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-8 px-4">
      <div>
        <h4 class="font-bold mb-2">Contato</h4>
        <p>üì± WhatsApp: (11) 91234-5678</p>
        <p>‚úâÔ∏è Email: contato@mundodosveus.com</p>
      </div>
      <div>
        <h4 class="font-bold mb-2">Links √öteis</h4>
        <ul>
          <li><a href="#" class="hover:underline">Pol√≠tica de Troca</a></li>
          <li><a href="#" class="hover:underline">Frete e Entrega</a></li>
          <li><a href="#" class="hover:underline">Termos e Condi√ß√µes</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-bold mb-2">Redes Sociais</h4>
        <p><a href="#" class="hover:underline">Instagram</a></p>
        <p><a href="#" class="hover:underline">Facebook</a></p>
        <p><a href="#" class="hover:underline">Pinterest</a></p>
      </div>
      <div>
        <h4 class="font-bold mb-2">Formas de Pagamento</h4>
        <p>üí≥ Cart√µes | Pix | Boleto</p>
        <img src="https://www.mercadopago.com.br/org-img/MP3/home/logos/visa.gif" alt="Visa" class="inline w-10">
        <img src="https://www.mercadopago.com.br/org-img/MP3/home/logos/master.gif" alt="MasterCard" class="inline w-10">
        <img src="https://www.mercadopago.com.br/org-img/MP3/home/logos/pix.gif" alt="Pix" class="inline w-10">
      </div>
    </div>
    <p class="text-center mt-6 text-sm text-purple-200">¬© 2025 Mundo dos V√©us. Todos os direitos reservados.</p>
  </footer>

  <!-- Script final -->
  <script>
    let subtotalCarrinho = 0;
    let frete = 0;
    let desconto = 0;

    document.addEventListener('DOMContentLoaded', () => {
      atualizarCarrinho();
    });

    document.getElementById('calcular-frete').addEventListener('click', () => {
      const cep = document.getElementById('cep').value;
      if (cep) {
        frete = calcularFrete(cep);
        document.getElementById('resultado-frete').textContent = `Valor do Frete: R$ ${frete.toFixed(2)}`;
        atualizarTotalFinal();
      } else {
        alert('Por favor, insira um CEP v√°lido.');
      }
    });

    function calcularFrete(cep) {
      return 20.00; // Exemplo fixo
    }

    document.getElementById('aplicar-cupom').addEventListener('click', () => {
      const cupom = document.getElementById('cupom').value;
      if (cupom === 'DESCONTO10') {
        desconto = 10;
        document.getElementById('resultado-cupom').textContent = `Desconto Aplicado: R$ ${desconto.toFixed(2)}`;
      } else {
        desconto = 0;
        document.getElementById('resultado-cupom').textContent = 'Cupom inv√°lido.';
      }
      atualizarTotalFinal();
    });

    function atualizarCarrinho() {
      const itens = JSON.parse(localStorage.getItem('carrinho')) || [];
      const lista = document.getElementById('itens-carrinho');
      let subtotal = 0;

      lista.innerHTML = '';

      itens.forEach((item, index) => {
        const li = document.createElement('li');
        li.classList.add("flex", "justify-between", "items-center", "bg-purple-50", "px-3", "py-2", "rounded-md");

        li.innerHTML = `
          <div class="flex-1">
            <span>${item.nome} x${item.quantidade} - R$ ${(item.preco * item.quantidade).toFixed(2)}</span>
          </div>
          <div class="flex gap-2 items-center ml-2">
            <button onclick="alterarQuantidade(${index}, -1)" class="text-purple-700 hover:text-purple-900 px-2 text-xl font-bold">‚àí</button>
            <button onclick="alterarQuantidade(${index}, 1)" class="text-purple-700 hover:text-purple-900 px-2 text-xl font-bold">+</button>
            <button onclick="removerItem(${index})" class="text-red-600 hover:text-red-800 px-2 text-xl">üóëÔ∏è</button>
          </div>
        `;

        lista.appendChild(li);
        subtotal += item.preco * item.quantidade;
      });

      subtotalCarrinho = subtotal;
      document.getElementById('subtotal-carrinho').textContent = subtotalCarrinho.toFixed(2);
      atualizarTotalFinal();
    }

    function atualizarTotalFinal() {
      const total = subtotalCarrinho + frete - desconto;
      document.getElementById('total-final').textContent = total.toFixed(2);
    }

    function alterarQuantidade(index, delta) {
      const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
      if (!carrinho[index]) return;

      carrinho[index].quantidade += delta;
      if (carrinho[index].quantidade <= 0) carrinho.splice(index, 1);

      localStorage.setItem('carrinho', JSON.stringify(carrinho));
      atualizarCarrinho();
    }

    function removerItem(index) {
      const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
      carrinho.splice(index, 1);
      localStorage.setItem('carrinho', JSON.stringify(carrinho));
      atualizarCarrinho();
    }
  </script>
  <!-- Firebase SDKs -->
<script type="module">
  // Importando m√≥dulos Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, getDocs, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  // Sua configura√ß√£o do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyD9FSLA-EOGRgvDbbaBqBge7j8gRl4WJkI",
    authDomain: "loja-de-veus.firebaseapp.com",
    projectId: "loja-de-veus",
    storageBucket: "loja-de-veus.appspot.com",
    messagingSenderId: "907809130966",
    appId: "1:907809130966:web:800dae192863cddbc2fc77",
    measurementId: "G-XDRVKSRMQP"
  };

  // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Torna auth e db globais
  window.auth = auth;
  window.db = db;
</script>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  // Configura√ß√£o do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyD9FSLA-EOGRgvDbbaBqBge7j8gRl4WJkI",
    authDomain: "loja-de-veus.firebaseapp.com",
    projectId: "loja-de-veus",
    storageBucket: "loja-de-veus.appspot.com",
    messagingSenderId: "907809130966",
    appId: "1:907809130966:web:800dae192863cddbc2fc77",
    measurementId: "G-XDRVKSRMQP"
  };

  // Inicializa√ß√£o do Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Refer√™ncias ao DOM
  const userInfoEl = document.getElementById("user-info");
  const loginLinkEl = document.getElementById("login-link");
  const saudacaoEl = document.getElementById("saudacao");
  const logoutBtnEl = document.getElementById("logout-link");
  const accountLinkEl = document.getElementById("account-link");

  // Verifica estado de autentica√ß√£o
  onAuthStateChanged(auth, async user => {
    if (user) {
      // Busca o nome do Firestore ou fallback
      let nome = user.displayName || "";
      try {
        const snap = await getDoc(doc(db, "usuarios", user.uid));
        if (snap.exists() && snap.data().nome) nome = snap.data().nome;
      } catch (e) {
        console.warn("Erro ao buscar nome:", e);
      }

      // Exibe as informa√ß√µes de login
      saudacaoEl.textContent = `Ol√°, ${nome || user.email.split("@")[0]}!`;
      userInfoEl.classList.remove("hidden");
      loginLinkEl.classList.add("hidden");
      accountLinkEl.classList.remove("hidden");
    } else {
      userInfoEl.classList.add("hidden");
      loginLinkEl.classList.remove("hidden");
      accountLinkEl.classList.add("hidden");
    }
  });

  // Fun√ß√£o de logout
  logoutBtnEl?.addEventListener("click", () => {
    signOut(auth)
      .then(() => window.location.href = "login.html")
      .catch(err => console.error(err));
  });
</script>


</body>
</html>
