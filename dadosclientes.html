<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Finalizar Compra - Mundo dos V√©us</title>
  <script src="js/finalizar.js" defer></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">

  <!-- Header padr√£o do site -->
  <header class="bg-white shadow-md px-6 py-4 flex justify-between items-center">
    <a href="#" class="text-2xl font-bold text-purple-700">Mundo dos V√©us</a>
    <div class="flex items-center gap-6">
      <nav class="hidden md:flex gap-4 font-medium text-gray-700">
        <a href="#">Home</a>
        <a href="#produtos">Produtos</a>
        <a href="#">Sobre</a>
        <a href="#">Contato</a>
      </nav>
      <div class="search-box hidden md:block">
        <input type="text" placeholder="Buscar...">
      </div>
      <div class="flex gap-4 text-lg">
        <a href="#">üõí</a>
        <a href="#">üë§ Login</a>
      </div>
    </div>
  </header>

  <!-- Link para voltar -->
  <a href="/carrinho.html" class="flex items-center text-purple-700 hover:underline mb-4">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
    Voltar
  </a>

  <main class="max-w-3xl mx-auto mt-6 p-4 bg-white shadow-md rounded">
    <h2 class="text-xl font-bold mb-4">Finalizar Pedido</h2>

    <!-- Resumo do Pedido -->
    <section id="resumo-pedido" class="mb-6">
      <h3 class="text-lg font-semibold mb-2">Resumo do Pedido</h3>
      <ul id="lista-itens" class="space-y-2 text-sm text-gray-700"></ul>
      <p class="mt-4 font-semibold">Subtotal: <span id="subtotal">R$ 0,00</span></p>
      <p>Frete (SEDEX): <span id="frete">R$ 0,00</span></p>
      <p class="text-lg font-bold mt-2">Total: <span id="total">R$ 0,00</span></p>
    </section>

    <!-- Formul√°rio -->
    <form id="form-finalizar-compra" class="space-y-6">

      <!-- Dados Pessoais -->
      <div class="space-y-4">
        <div>
          <label for="nome" class="block text-sm font-semibold">Nome Completo:</label>
          <input type="text" id="nome" class="w-full p-2 border rounded" required>
        </div>
        <div>
          <label for="email" class="block text-sm font-semibold">E-mail:</label>
          <input type="email" id="email" class="w-full p-2 border rounded" required>
        </div>
        <div>
          <label for="telefone" class="block text-sm font-semibold">Telefone (WhatsApp):</label>
          <input type="tel" id="telefone" class="w-full p-2 border rounded" required>
        </div>
        <div>
          <label for="cpf" class="block text-sm font-semibold">CPF:</label>
          <input type="text" id="cpf" class="w-full p-2 border rounded" required>
        </div>
      </div>

      <!-- Endere√ßo -->
      <div class="space-y-4">
        <div>
          <label for="cep" class="block text-sm font-semibold">CEP:</label>
          <input type="text" id="cep" class="w-full p-2 border rounded" required>
        </div>
        <div>
          <label for="logradouro" class="block text-sm font-semibold">Rua:</label>
          <input type="text" id="logradouro" class="w-full p-2 border rounded" required>
        </div>
        <div>
          <label for="numero" class="block text-sm font-semibold">N√∫mero:</label>
          <input type="text" id="numero" class="w-full p-2 border rounded" required>
        </div>
        <div>
          <label for="bairro" class="block text-sm font-semibold">Bairro:</label>
          <input type="text" id="bairro" class="w-full p-2 border rounded" required>
        </div>
        <div>
          <label for="cidade" class="block text-sm font-semibold">Cidade:</label>
          <input type="text" id="cidade" class="w-full p-2 border rounded" required>
        </div>
        <div>
          <label for="estado" class="block text-sm font-semibold">Estado:</label>
          <input type="text" id="estado" class="w-full p-2 border rounded" required>
        </div>
      </div>

      <!-- Forma de Pagamento -->
      <div>
        <label for="forma-pagamento" class="block text-sm font-semibold">Forma de Pagamento:</label>
        <select id="forma-pagamento" class="w-full p-2 border rounded" required>
          <option value="">Selecione</option>
          <option value="cartao">Cart√£o de Cr√©dito</option>
          <option value="boleto">Boleto Banc√°rio</option>
          <option value="pix">Pix</option>
        </select>
      </div>

      <!-- Observa√ß√µes -->
      <div>
        <label for="observacoes" class="block text-sm font-semibold">Observa√ß√µes:</label>
        <textarea id="observacoes" rows="3" class="w-full p-2 border rounded" placeholder="Ex: Entregar ap√≥s √†s 18h."></textarea>
      </div>

      <!-- Aceite de Termos -->
      <div class="flex items-center space-x-2">
        <input type="checkbox" id="termos" required>
        <label for="termos" class="text-sm">Li e aceito os <a href="#" class="text-purple-700 underline">Termos e Condi√ß√µes</a>.</label>
      </div>

      <!-- Bot√£o Finalizar -->
      <div class="text-right">
        <button type="submit" class="bg-purple-700 text-white px-6 py-2 rounded hover:bg-purple-800 transition">
          Finalizar Pedido
        </button>
      </div>
    </form>
  </main>

  <!-- Rodap√© padr√£o -->
  <footer class="bg-purple-800 text-white py-10">
    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-8 px-4">
      <div>
        <h4 class="font-bold mb-2">Contato</h4>
        <p>üì± WhatsApp: (11) 91234-5678</p>
        <p>‚úâÔ∏è Email: contato@mundodosveus.com</p>
      </div>
      <div>
        <h4 class="font-bold mb-2">Links √öteis</h4>
        <ul>
          <li><a href="#" class="hover:underline">Pol√≠tica de Troca</a></li>
          <li><a href="#" class="hover:underline">Frete e Entrega</a></li>
          <li><a href="#" class="hover:underline">Termos e Condi√ß√µes</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-bold mb-2">Redes Sociais</h4>
        <p><a href="#" class="hover:underline">Instagram</a></p>
        <p><a href="#" class="hover:underline">Facebook</a></p>
        <p><a href="#" class="hover:underline">Pinterest</a></p>
      </div>
      <div>
        <h4 class="font-bold mb-2">Formas de Pagamento</h4>
        <p>üí≥ Cart√µes | Pix | Boleto</p>
        <img src="https://www.mercadopago.com.br/org-img/MP3/home/logos/visa.gif" alt="Visa" class="inline w-10">
        <img src="https://www.mercadopago.com.br/org-img/MP3/home/logos/master.gif" alt="MasterCard" class="inline w-10">
        <img src="https://www.mercadopago.com.br/org-img/MP3/home/logos/pix.gif" alt="Pix" class="inline w-10">
      </div>
    </div>
    <p class="text-center mt-6 text-sm text-purple-200">¬© 2025 Mundo dos V√©us. Todos os direitos reservados.</p>
  </footer>

  <!-- IMask.js -->
  <script src="https://unpkg.com/imask"></script>

  <!-- Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
      const lista = document.getElementById('lista-itens');
      let subtotal = 0;

      if (carrinho.length === 0) {
        lista.innerHTML = '<li class="text-red-500">Carrinho vazio.</li>';
      }

      carrinho.forEach(item => {
        const li = document.createElement('li');
        li.textContent = `${item.nome} - ${item.quantidade}x R$ ${item.preco.toFixed(2)}`;
        lista.appendChild(li);
        subtotal += item.preco * item.quantidade;
      });

      const freteFixo = 15.00;
      document.getElementById('subtotal').textContent = 'R$ ' + subtotal.toFixed(2);
      document.getElementById('frete').textContent = 'R$ ' + freteFixo.toFixed(2);
      document.getElementById('total').textContent = 'R$ ' + (subtotal + freteFixo).toFixed(2);

      // M√°scaras de entrada
      IMask(document.getElementById('telefone'), { mask: '(00) 00000-0000' });
      IMask(document.getElementById('cpf'), { mask: '000.000.000-00' });
      IMask(document.getElementById('cep'), { mask: '00000-000' });

      // Preenchimento autom√°tico do endere√ßo ao digitar o CEP
      document.getElementById('cep').addEventListener('blur', function () {
        const cep = this.value.replace(/\D/g, '');
        if (cep.length !== 8) {
          alert('CEP inv√°lido!');
          return;
        }

        fetch(`https://viacep.com.br/ws/${cep}/json/`)
          .then(response => response.json())
          .then(data => {
            if (data.erro) {
              alert('CEP n√£o encontrado!');
              return;
            }

            document.getElementById('logradouro').value = data.logradouro || '';
            document.getElementById('bairro').value = data.bairro || '';
            document.getElementById('cidade').value = data.localidade || '';
            document.getElementById('estado').value = data.uf || '';
          })
          .catch(() => {
            alert('Erro ao buscar o CEP. Tente novamente.');
          });
      });
    });

    document.getElementById('form-finalizar-compra').addEventListener('submit', function(event) {
      event.preventDefault();

      const pedido = {
        nome: document.getElementById('nome').value,
        email: document.getElementById('email').value,
        telefone: document.getElementById('telefone').value,
        cpf: document.getElementById('cpf').value,
        endereco: {
          cep: document.getElementById('cep').value,
          logradouro: document.getElementById('logradouro').value,
          numero: document.getElementById('numero').value,
          bairro: document.getElementById('bairro').value,
          cidade: document.getElementById('cidade').value,
          estado: document.getElementById('estado').value,
        },
        formaPagamento: document.getElementById('forma-pagamento').value,
        observacoes: document.getElementById('observacoes').value,
        itens: JSON.parse(localStorage.getItem('carrinho')) || [],
        total: document.getElementById('total').textContent.replace('R$ ', '')
      };

      localStorage.setItem('pedido', JSON.stringify(pedido));
      window.location.href = 'agradecimento.html';
    });
  </script>

</body>
</html>
